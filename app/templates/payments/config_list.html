{% extends "layouts/dashboard.html" %}

{% block title %}Configuration paiements - GigRoute{% endblock %}

{% block page_header %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h1 class="h2 mb-1">
            <i class="bi bi-gear me-2"></i>
            Configuration des paiements
        </h1>
        <p class="text-muted mb-0">Taux par défaut et informations bancaires des membres</p>
    </div>
    <a href="{{ url_for('payments.index') }}" class="btn btn-outline-secondary">
        <i class="bi bi-arrow-left me-1"></i>Retour
    </a>
</div>
{% endblock %}

{% block content %}
<!-- Members with config -->
{% if configs %}
<div class="card border-0 shadow-sm mb-4">
    <div class="card-header bg-transparent">
        <h5 class="mb-0">Membres configurés ({{ configs|length }})</h5>
    </div>
    <div class="table-responsive">
        <table class="table table-hover mb-0">
            <thead class="table-light">
                <tr>
                    <th>Membre</th>
                    <th class="d-none d-md-table-cell">Catégorie</th>
                    <th class="d-none d-lg-table-cell">Role</th>
                    <th class="d-none d-lg-table-cell">Contrat</th>
                    <th class="text-end">Taux</th>
                    <th class="text-end d-none d-md-table-cell">Per Diem</th>
                    <th class="d-none d-md-table-cell">IBAN</th>
                    <th class="text-end">Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for config in configs %}
                <tr>
                    <td>
                        <div class="d-flex align-items-center">
                            <div class="avatar me-2 bg-{{ 'success' if config.staff_category and config.staff_category.value == 'artistic' else 'info' if config.staff_category and config.staff_category.value == 'technical' else 'warning' if config.staff_category and config.staff_category.value == 'management' else 'secondary' }} text-white rounded-circle d-flex align-items-center justify-content-center" style="width: 32px; height: 32px;">
                                {{ config.user.first_name[0] if config.user else '?' }}
                            </div>
                            <div>
                                <div class="fw-medium">{{ config.user.full_name if config.user else 'N/A' }}</div>
                                <small class="text-muted">{{ config.user.email if config.user else '' }}</small>
                            </div>
                        </div>
                    </td>
                    <td class="d-none d-md-table-cell">
                        <span class="badge bg-{{ 'success' if config.staff_category and config.staff_category.value == 'artistic' else 'info' if config.staff_category and config.staff_category.value == 'technical' else 'warning' if config.staff_category and config.staff_category.value == 'management' else 'secondary' }}">
                            {{ config.staff_category.value if config.staff_category else '-' }}
                        </span>
                    </td>
                    <td class="d-none d-lg-table-cell">{{ config.staff_role.value|tr('staff_role') if config.staff_role else '-' }}</td>
                    <td class="d-none d-lg-table-cell">
                        {% if config.is_intermittent %}
                        <span class="badge bg-purple text-white">Intermittent</span>
                        {% else %}
                        {{ config.contract_type.value if config.contract_type else '-' }}
                        {% endif %}
                    </td>
                    <td class="text-end">
                        {% if config.show_rate %}
                        <small class="text-muted">Concert:</small> {{ "{:,.0f}".format(config.show_rate) }} EUR
                        {% elif config.daily_rate %}
                        <small class="text-muted">Jour:</small> {{ "{:,.0f}".format(config.daily_rate) }} EUR
                        {% elif config.weekly_rate %}
                        <small class="text-muted">Sem:</small> {{ "{:,.0f}".format(config.weekly_rate) }} EUR
                        {% else %}
                        -
                        {% endif %}
                    </td>
                    <td class="text-end d-none d-md-table-cell">{{ "{:,.0f}".format(config.per_diem) if config.per_diem else '-' }} EUR</td>
                    <td class="d-none d-md-table-cell">
                        {% if config.iban %}
                        <span class="badge bg-success">Configuré</span>
                        {% else %}
                        <span class="badge bg-secondary">Non</span>
                        {% endif %}
                    </td>
                    <td class="text-end">
                        <a href="{{ url_for('payments.config_edit', user_id=config.user_id) }}" class="btn btn-sm btn-outline-primary" aria-label="Modifier">
                            <i class="bi bi-pencil"></i>
                        </a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endif %}

<!-- Members without config -->
{% if users_without_config %}
<div class="card border-0 shadow-sm">
    <div class="card-header bg-transparent">
        <h5 class="mb-0">Membres sans configuration ({{ users_without_config|length }})</h5>
    </div>
    <div class="table-responsive">
        <table class="table table-hover mb-0">
            <thead class="table-light">
                <tr>
                    <th>Membre</th>
                    <th>Email</th>
                    <th class="text-end">Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for user in users_without_config %}
                <tr>
                    <td>
                        <div class="d-flex align-items-center">
                            <div class="avatar me-2 bg-secondary text-white rounded-circle d-flex align-items-center justify-content-center" style="width: 32px; height: 32px;">
                                {{ user.first_name[0] }}
                            </div>
                            <div class="fw-medium">{{ user.full_name }}</div>
                        </div>
                    </td>
                    <td class="text-muted">{{ user.email }}</td>
                    <td class="text-end">
                        <a href="{{ url_for('payments.config_edit', user_id=user.id) }}" class="btn btn-sm btn-primary">
                            <i class="bi bi-plus-lg me-1"></i>Configurer
                        </a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endif %}

{% if not configs and not users_without_config %}
<div class="text-center py-5">
    <i class="bi bi-people text-muted" style="font-size: 4rem;"></i>
    <h3 class="mt-3">Aucun membre</h3>
    <p class="text-muted">Ajoutez des membres à l'équipe pour configurer leurs paiements.</p>
</div>
{% endif %}
{% endblock %}
